{
  "uid": "mariadb-exporter",
  "title": "MariaDB Exporter",
  "tags": ["mariadb", "exporter", "prometheus"],
  "schemaVersion": 38,
  "version": 2,
  "refresh": "30s",
  "time": {"from": "now-6h", "to": "now"},
  "timezone": "browser",
  "description": "Overview dashboard for mariadb_exporter metrics.",
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__requires": [
    {"type": "grafana", "id": "grafana", "name": "Grafana", "version": "10.0.0"},
    {"type": "datasource", "id": "prometheus", "name": "Prometheus", "version": "1.0.0"},
    {"type": "panel", "id": "timeseries", "name": "Time series", "version": "1.0.0"},
    {"type": "panel", "id": "stat", "name": "Stat", "version": "1.0.0"},
    {"type": "panel", "id": "table", "name": "Table", "version": "1.0.0"},
    {"type": "panel", "id": "row", "name": "Row", "version": "1.0.0"}
  ],
  "templating": {
    "list": [
      {
        "name": "job",
        "type": "query",
        "datasource": "${DS_PROMETHEUS}",
        "refresh": 1,
        "label": "Job",
        "query": "label_values(mariadb_up, job)",
        "definition": "label_values(mariadb_up, job)",
        "includeAll": false,
        "multi": false
      },
      {
        "name": "instance",
        "type": "query",
        "datasource": "${DS_PROMETHEUS}",
        "refresh": 1,
        "label": "Instance",
        "query": "label_values(mariadb_up{job=\"$job\"}, instance)",
        "definition": "label_values(mariadb_up{job=\"$job\"}, instance)",
        "includeAll": false,
        "multi": false
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "type": "stat",
      "title": "MariaDB Up",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 4, "w": 3, "x": 0, "y": 0},
      "targets": [{"expr": "mariadb_up{job=\"$job\",instance=\"$instance\"}", "refId": "A"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "orientation": "horizontal"},
      "fieldConfig": {"defaults": {"unit": "none", "thresholds": {"mode": "absolute", "steps": [{"color": "red"}, {"color": "green", "value": 1}]}}, "overrides": []}
    },
    {
      "id": 2,
      "type": "stat",
      "title": "Uptime",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 4, "w": 5, "x": 3, "y": 0},
      "targets": [{"expr": "mariadb_global_status_uptime_seconds{job=\"$job\",instance=\"$instance\"}", "refId": "A"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}},
      "fieldConfig": {"defaults": {"unit": "s"}, "overrides": []}
    },
    {
      "id": 3,
      "type": "stat",
      "title": "Current QPS",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 4, "w": 5, "x": 8, "y": 0},
      "targets": [{"expr": "rate(mariadb_global_status_questions{job=\"$job\",instance=\"$instance\"}[1m])", "refId": "A"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}},
      "fieldConfig": {"defaults": {"unit": "reqps"}, "overrides": []}
    },
    {
      "id": 4,
      "type": "stat",
      "title": "InnoDB Buffer Pool Size",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 4, "w": 5, "x": 13, "y": 0},
      "targets": [{"expr": "mariadb_innodb_buffer_pool_bytes_data{job=\"$job\",instance=\"$instance\"}", "refId": "A"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}},
      "fieldConfig": {"defaults": {"unit": "bytes"}, "overrides": []}
    },
    {
      "id": 5,
      "type": "stat",
      "title": "Buffer Pool / RAM",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
      "targets": [{"expr": "mariadb_innodb_buffer_pool_bytes_data{job=\"$job\",instance=\"$instance\"} / node_memory_MemTotal_bytes{instance=\"$instance\"}", "refId": "A"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}},
      "fieldConfig": {"defaults": {"unit": "percentunit"}, "overrides": []}
    },
    {
      "id": 6,
      "type": "table",
      "title": "Version / Build",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 4, "w": 12, "x": 0, "y": 4},
      "targets": [
        {"expr": "mariadb_version_num{job=\"$job\",instance=\"$instance\"}", "refId": "A"},
        {"expr": "mariadb_version_info{job=\"$job\",instance=\"$instance\"}", "refId": "B"},
        {"expr": "mariadb_exporter_build_info{job=\"$job\",instance=\"$instance\"}", "refId": "C"}
      ],
      "options": {"showHeader": true},
      "transformations": [{"id": "merge", "options": {}}]
    },
    {
      "id": 7,
      "type": "timeseries",
      "title": "Connections & Threads",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
      "targets": [
        {"expr": "mariadb_global_status_threads_connected{job=\"$job\",instance=\"$instance\"}", "refId": "A", "legendFormat": "threads_connected"},
        {"expr": "mariadb_global_status_threads_running{job=\"$job\",instance=\"$instance\"}", "refId": "B", "legendFormat": "threads_running"},
        {"expr": "mariadb_global_status_connections{job=\"$job\",instance=\"$instance\"}", "refId": "C", "legendFormat": "connections"},
        {"expr": "mariadb_global_status_max_used_connections{job=\"$job\",instance=\"$instance\"}", "refId": "D", "legendFormat": "max_used_connections"}
      ]
    },
    {
      "id": 8,
      "type": "timeseries",
      "title": "Traffic (bytes/s)",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
      "targets": [
        {"expr": "rate(mariadb_global_status_bytes_received{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "A", "legendFormat": "bytes_received"},
        {"expr": "rate(mariadb_global_status_bytes_sent{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "B", "legendFormat": "bytes_sent"}
      ],
      "fieldConfig": {"defaults": {"unit": "Bps"}, "overrides": []}
    },
    {
      "id": 9,
      "type": "timeseries",
      "title": "Queries per second",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 12},
      "targets": [
        {"expr": "rate(mariadb_global_status_questions{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "A", "legendFormat": "questions"},
        {"expr": "rate(mariadb_global_status_queries{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "B", "legendFormat": "queries"},
        {"expr": "rate(mariadb_global_status_slow_queries{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "C", "legendFormat": "slow_queries"}
      ]
    },
    {
      "id": 10,
      "type": "timeseries",
      "title": "Connection Errors",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
      "targets": [
        {"expr": "rate(mariadb_global_status_aborted_connects{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "A", "legendFormat": "aborted_connects"},
        {"expr": "rate(mariadb_global_status_aborted_clients{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "B", "legendFormat": "aborted_clients"},
        {"expr": "rate(mariadb_global_status_connection_errors_max_connections{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "C", "legendFormat": "conn_errors_max_connections"},
        {"expr": "rate(mariadb_global_status_connection_errors_too_many_connections{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "D", "legendFormat": "conn_errors_too_many"},
        {"expr": "rate(mariadb_global_status_connection_errors_refused{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "E", "legendFormat": "conn_errors_refused"},
        {"expr": "rate(mariadb_global_status_created_tmp_disk_tables{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "F", "legendFormat": "tmp_disk_tables"}
      ]
    },
    {
      "id": 11,
      "type": "timeseries",
      "title": "InnoDB Buffer Pool",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 20},
      "targets": [
        {"expr": "mariadb_innodb_buffer_pool_pages_data{job=\"$job\",instance=\"$instance\"}", "refId": "A", "legendFormat": "pages_data"},
        {"expr": "mariadb_innodb_buffer_pool_pages_dirty{job=\"$job\",instance=\"$instance\"}", "refId": "B", "legendFormat": "pages_dirty"},
        {"expr": "mariadb_innodb_buffer_pool_pages_free{job=\"$job\",instance=\"$instance\"}", "refId": "C", "legendFormat": "pages_free"},
        {"expr": "mariadb_innodb_buffer_pool_bytes_data{job=\"$job\",instance=\"$instance\"}", "refId": "D", "legendFormat": "bytes_data"},
        {"expr": "mariadb_innodb_buffer_pool_bytes_dirty{job=\"$job\",instance=\"$instance\"}", "refId": "E", "legendFormat": "bytes_dirty"}
      ]
    },
    {
      "id": 12,
      "type": "timeseries",
      "title": "InnoDB IO & Locks",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
      "targets": [
        {"expr": "rate(mariadb_innodb_buffer_pool_read_requests{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "A", "legendFormat": "read_requests"},
        {"expr": "rate(mariadb_innodb_buffer_pool_reads{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "B", "legendFormat": "reads"},
        {"expr": "rate(mariadb_innodb_buffer_pool_write_requests{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "C", "legendFormat": "write_requests"},
        {"expr": "rate(mariadb_innodb_log_written{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "D", "legendFormat": "log_written"},
        {"expr": "rate(mariadb_innodb_log_waits{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "E", "legendFormat": "log_waits"},
        {"expr": "rate(mariadb_innodb_log_write_requests{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "F", "legendFormat": "log_write_requests"},
        {"expr": "mariadb_innodb_row_lock_time_seconds{job=\"$job\",instance=\"$instance\"}", "refId": "G", "legendFormat": "row_lock_time_seconds"},
        {"expr": "mariadb_innodb_row_lock_waits{job=\"$job\",instance=\"$instance\"}", "refId": "H", "legendFormat": "row_lock_waits"},
        {"expr": "mariadb_innodb_history_list_length{job=\"$job\",instance=\"$instance\"}", "refId": "I", "legendFormat": "history_list_length"},
        {"expr": "mariadb_innodb_data_pending_reads{job=\"$job\",instance=\"$instance\"}", "refId": "J", "legendFormat": "pending_reads"},
        {"expr": "mariadb_innodb_data_pending_writes{job=\"$job\",instance=\"$instance\"}", "refId": "K", "legendFormat": "pending_writes"}
      ]
    },
    {
      "id": 13,
      "type": "row",
      "title": "Replication & Binlog (collector)",
      "collapsed": true,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 32},
      "panels": [
        {
          "id": 14,
          "type": "timeseries",
          "title": "Replication & Binlog",
          "datasource": "${DS_PROMETHEUS}",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 33},
          "targets": [
            {"expr": "mariadb_slave_status_seconds_behind_master{job=\"$job\",instance=\"$instance\"}", "refId": "A", "legendFormat": "seconds_behind"},
            {"expr": "mariadb_slave_status_sql_running{job=\"$job\",instance=\"$instance\"}", "refId": "B", "legendFormat": "sql_running"},
            {"expr": "mariadb_slave_status_io_running{job=\"$job\",instance=\"$instance\"}", "refId": "C", "legendFormat": "io_running"},
            {"expr": "rate(mariadb_binlog_bytes_written{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "D", "legendFormat": "binlog_bytes_written"},
            {"expr": "rate(mariadb_binlog_cache_disk_use{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "E", "legendFormat": "binlog_cache_disk_use"},
            {"expr": "rate(mariadb_binlog_stmt_cache_disk_use{job=\"$job\",instance=\"$instance\"}[5m])", "refId": "F", "legendFormat": "binlog_stmt_cache_disk_use"},
            {"expr": "mariadb_replica_relay_log_space_bytes{job=\"$job\",instance=\"$instance\"}", "refId": "G", "legendFormat": "relay_log_space_bytes"},
            {"expr": "mariadb_replica_relay_log_pos{job=\"$job\",instance=\"$instance\"}", "refId": "H", "legendFormat": "relay_log_pos"},
            {"expr": "mariadb_primary_binlog_files{job=\"$job\",instance=\"$instance\"}", "refId": "I", "legendFormat": "primary_binlog_files"}
          ]
        }
      ]
    },
    {
      "id": 15,
      "type": "row",
      "title": "Config / TLS / Audit (collectors)",
      "collapsed": true,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 33},
      "panels": [
        {
          "id": 16,
          "type": "stat",
          "title": "Config / TLS / Audit",
          "datasource": "${DS_PROMETHEUS}",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 34},
          "targets": [
            {"expr": "mariadb_global_variables_have_ssl{job=\"$job\",instance=\"$instance\"}", "refId": "A"},
            {"expr": "mariadb_global_variables_have_openssl{job=\"$job\",instance=\"$instance\"}", "refId": "B"},
            {"expr": "mariadb_global_variables_performance_schema{job=\"$job\",instance=\"$instance\"}", "refId": "C"},
            {"expr": "mariadb_tls_session_active{job=\"$job\",instance=\"$instance\"}", "refId": "D"},
            {"expr": "mariadb_tls_version_info{job=\"$job\",instance=\"$instance\"}", "refId": "E"},
            {"expr": "mariadb_audit_log_enabled{job=\"$job\",instance=\"$instance\"}", "refId": "F"}
          ],
          "options": {"reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}},
          "transformations": [{"id": "merge", "options": {}}]
        }
      ]
    },
    {
      "id": 17,
      "type": "row",
      "title": "Locks (collector)",
      "collapsed": true,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 34},
      "panels": [
        {
          "id": 18,
          "type": "stat",
          "title": "Locking",
          "datasource": "${DS_PROMETHEUS}",
          "gridPos": {"h": 6, "w": 24, "x": 0, "y": 35},
          "targets": [
            {"expr": "mariadb_perf_schema_metadata_lock_count{job=\"$job\",instance=\"$instance\"}", "refId": "A"},
            {"expr": "mariadb_perf_schema_table_lock_waits{job=\"$job\",instance=\"$instance\"}", "refId": "B"},
            {"expr": "mariadb_metadata_lock_info_count{job=\"$job\",instance=\"$instance\"}", "refId": "C"}
          ],
          "transformations": [{"id": "merge", "options": {}}]
        }
      ]
    },
    {
      "id": 19,
      "type": "row",
      "title": "Schema (collector)",
      "collapsed": true,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 35},
      "panels": [
        {
          "id": 20,
          "type": "table",
          "title": "Schema sizes (top 10)",
          "datasource": "${DS_PROMETHEUS}",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 36},
          "targets": [
            {"expr": "topk(10, mariadb_info_schema_table_size_bytes{job=\"$job\",instance=\"$instance\"})", "refId": "A"},
            {"expr": "topk(10, mariadb_info_schema_table_rows{job=\"$job\",instance=\"$instance\"})", "refId": "B"}
          ],
          "options": {"showHeader": true},
          "transformations": [{"id": "merge", "options": {}}]
        }
      ]
    },
    {
      "id": 21,
      "type": "row",
      "title": "Query Response Time (collector)",
      "collapsed": true,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 36},
      "panels": [
        {
          "id": 22,
          "type": "timeseries",
          "title": "Query Response Time buckets",
          "datasource": "${DS_PROMETHEUS}",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 37},
          "targets": [
            {"expr": "sum by (le) (mariadb_info_schema_query_response_time_seconds{job=\"$job\",instance=\"$instance\"})", "refId": "A", "legendFormat": "le {{le}}"}
          ]
        }
      ]
    },
    {
      "id": 23,
      "type": "row",
      "title": "Statements (collector)",
      "collapsed": true,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 37},
      "panels": [
        {
          "id": 24,
          "type": "table",
          "title": "Statement digests",
          "datasource": "${DS_PROMETHEUS}",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 38},
          "targets": [
            {"expr": "topk(5, mariadb_perf_schema_digest_latency_seconds_total{job=\"$job\",instance=\"$instance\"})", "refId": "A"},
            {"expr": "topk(5, mariadb_perf_schema_digest_total{job=\"$job\",instance=\"$instance\"})", "refId": "B"},
            {"expr": "topk(5, mariadb_perf_schema_digest_errors{job=\"$job\",instance=\"$instance\"})", "refId": "C"},
            {"expr": "topk(5, mariadb_perf_schema_digest_warnings{job=\"$job\",instance=\"$instance\"})", "refId": "D"},
            {"expr": "topk(5, mariadb_perf_schema_digest_rows_examined{job=\"$job\",instance=\"$instance\"})", "refId": "E"},
            {"expr": "topk(5, mariadb_perf_schema_digest_rows_sent{job=\"$job\",instance=\"$instance\"})", "refId": "F"},
            {"expr": "topk(5, mariadb_perf_schema_digest_latency_seconds{job=\"$job\",instance=\"$instance\"})", "refId": "G"}
          ],
          "options": {"showHeader": true},
          "transformations": [{"id": "merge", "options": {}}]
        }
      ]
    },
    {
      "id": 25,
      "type": "row",
      "title": "User Statistics (collector)",
      "collapsed": true,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 38},
      "panels": [
        {
          "id": 26,
          "type": "table",
          "title": "User statistics",
          "datasource": "${DS_PROMETHEUS}",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 39},
          "targets": [
            {"expr": "mariadb_userstat_enabled{job=\"$job\",instance=\"$instance\"}", "refId": "A"},
            {"expr": "topk(10, mariadb_info_schema_userstats_connections_total{job=\"$job\",instance=\"$instance\"})", "refId": "B"},
            {"expr": "topk(10, mariadb_info_schema_userstats_bytes_received_total{job=\"$job\",instance=\"$instance\"})", "refId": "C"},
            {"expr": "topk(10, mariadb_info_schema_userstats_bytes_sent_total{job=\"$job\",instance=\"$instance\"})", "refId": "D"},
            {"expr": "topk(10, mariadb_info_schema_userstats_rows_read_total{job=\"$job\",instance=\"$instance\"})", "refId": "E"},
            {"expr": "topk(10, mariadb_info_schema_userstats_rows_sent_total{job=\"$job\",instance=\"$instance\"})", "refId": "F"},
            {"expr": "topk(10, mariadb_info_schema_userstats_rows_deleted_total{job=\"$job\",instance=\"$instance\"})", "refId": "G"},
            {"expr": "topk(10, mariadb_info_schema_userstats_rows_inserted_total{job=\"$job\",instance=\"$instance\"})", "refId": "H"},
            {"expr": "topk(10, mariadb_info_schema_userstats_rows_updated_total{job=\"$job\",instance=\"$instance\"})", "refId": "I"}
          ],
          "options": {"showHeader": true},
          "transformations": [{"id": "merge", "options": {}}]
        }
      ]
    },
    {
      "id": 27,
      "type": "timeseries",
      "title": "Exporter health",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 39},
      "targets": [
        {"expr": "histogram_quantile(0.95, sum by (le) (rate(mariadb_exporter_collector_scrape_duration_seconds_bucket{job=\"$job\"}[5m])))", "refId": "A", "legendFormat": "p95 scrape duration"},
        {"expr": "sum by (collector) (increase(mariadb_exporter_collector_scrape_errors_total{job=\"$job\"}[5m]))", "refId": "B", "legendFormat": "errors {{collector}}"},
        {"expr": "mariadb_exporter_collector_last_scrape_success{job=\"$job\"}", "refId": "C", "legendFormat": "last scrape success {{collector}}"},
        {"expr": "mariadb_exporter_collector_last_scrape_timestamp_seconds{job=\"$job\"}", "refId": "D", "legendFormat": "last scrape ts {{collector}}"},
        {"expr": "mariadb_exporter_metrics_total{job=\"$job\",instance=\"$instance\"}", "refId": "E", "legendFormat": "metrics_total"},
        {"expr": "mariadb_exporter_scrapes_total{job=\"$job\",instance=\"$instance\"}", "refId": "F", "legendFormat": "scrapes_total"}
      ]
    },
    {
      "id": 28,
      "type": "timeseries",
      "title": "Exporter process",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 47},
      "targets": [
        {"expr": "mariadb_exporter_process_cpu_percent{job=\"$job\",instance=\"$instance\"}", "refId": "A", "legendFormat": "cpu_percent"},
        {"expr": "mariadb_exporter_process_cpu_cores{job=\"$job\",instance=\"$instance\"}", "refId": "B", "legendFormat": "cpu_cores"},
        {"expr": "mariadb_exporter_process_resident_memory_bytes{job=\"$job\",instance=\"$instance\"}", "refId": "C", "legendFormat": "rss"},
        {"expr": "mariadb_exporter_process_virtual_memory_bytes{job=\"$job\",instance=\"$instance\"}", "refId": "D", "legendFormat": "vms"},
        {"expr": "mariadb_exporter_process_open_fds{job=\"$job\",instance=\"$instance\"}", "refId": "E", "legendFormat": "open_fds"},
        {"expr": "mariadb_exporter_process_start_time_seconds{job=\"$job\",instance=\"$instance\"}", "refId": "F", "legendFormat": "start_time"}
      ]
    }
  ]
}
